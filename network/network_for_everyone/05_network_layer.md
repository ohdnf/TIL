# 네트워크 계층: 목적지에 데이터 전달하기



## 네트워크 계층의 역할

이더넷 규칙을 기반으로 데이터를 전송하는 데이터 링크 계층의 기능만으로는 다른 네트워크로 데이터를 전송하기 어렵다. 데이터 링크 계층이 네트워크 내 통신을 가능하게 하는 것이라면 네트워크 계층은 **네트워크 간의 통신을 가능**하게 한다. 이를 위해 **라우터(router)**라는 장비가 필요하다.

### 라우터

IP 주소로 네트워크를 식별해 다른 네트워크에 있는 **목적지 IP 주소까지 어떤 경로로 데이터를 보낼지 결정**하는 라우팅(routing) 기능을 제공한다. 경로 정보는 라우팅 테이블에 등록하고 관리한다.

### IP(Internet Protocol)

네트워크 계층에서 캡슐화할 때 다른 네트워크에 보낼 수 있도록 데이터에 붙이는 헤더 정보

```
데이터 + IP 헤더 ==(캡슐화)==> IP 패킷
```

#### IP 헤더

- 버전
- 헤더 길이
- 서비스 유형
- 전체 패킷 길이
- ID(일련번호)
- 조각 상태(flags)
- 조각의 위치(fragment offset)
- TTL
- 프로토콜
- 헤더 체크섬
- **출발지 IP 주소(32비트)**
- **목적지 IP 주소(32비트)**



## IP 주소의 구조

### IP 주소

인터넷 서비스 제공자(ISP)가 생성하여 제공

- 버전

  - IPv4(32비트)
    - 약 43억 개 할당 가능
  - IPv6(128비트)
    - 약 340간 개 할당 가능

- 종류

  - 공인 IP

    - 인터넷 서비스 제공자에서 제공
    - 인터넷에 직접 연결되는 컴퓨터나 라우터에 할당

  - 사설 IP

    - 회사나 가정의 랜에 있는 컴퓨터에 할당

    - 네트워크 관리자가 자유롭게 설정하거나 라우터의 DHCP 기능 사용하여 자동 할당

      > DHCP(Dynamic Host Configuration Protocol)
      >
      > <img src="https://www.netmanias.com/ko/?m=attach&no=1987" alt="DHCP" style="zoom: 80%;" />
      >
      > [참고](https://www.netmanias.com/ko/post/blog/5348/dhcp-ip-allocation-network-protocol/understanding-the-basic-operations-of-dhcp)



### MAC 주소 vs. IP 주소

- MAC 주소는 48비트, 16진수로 표시
- IP 주소는 32비트, 10진수로 표시(IPv4 기준)

```
IPv4 기준 IP 주소

실제 IPv4 주소(2진수): 11000000101010000000000100001010

  1옥텟     2옥텟    3옥텟     4옥텟		# 1옥텟 == 8비트
11000000 10101000 00000001 00001010
   192      168       1       10
   
사람이 읽는 주소(10진수): 192.168.1.10
```



## IP 주소의 클래스 구조

### A 클래스

8비트 네트워크 ID + 24비트 호스트 ID

```
Network ID |           Host ID
 00000000  |  00000000 00000000 00000000
    ~      |      ~        ~        ~
 01111111  |  11111111 11111111 11111111

1.0.0.0 ~ 127.255.255.255
```

호스트 수: 1677만 7214대

| 공인 IP 주소 범위                                       | 사설 IP 주소 범위         |
| ------------------------------------------------------- | ------------------------- |
| 1.0.0.0 ~ 9.255.255.255<br />11.0.0.0 ~ 126.255.255.255 | 10.0.0.0 ~ 10.255.255.255 |



### B 클래스

16비트 네트워크 ID + 16비트 호스트 ID

```
    Network ID     |       Host ID
10000000 00000000  |  00000000 00000000
   ~        ~      |      ~        ~
10111111 11111111  |  11111111 11111111

128.0.0.0 ~ 191.255.255.255
```

호스트 수: 6만 5534대

| 공인 IP 주소 범위                                            | 사설 IP 주소 범위           |
| ------------------------------------------------------------ | --------------------------- |
| 128.0.0.0 ~ 172.15.255.255<br />172.32.0.0 ~ 191.255.255.255 | 172.16.0.0 ~ 172.31.255.255 |



### C 클래스

24비트 네트워크 ID + 8비트 호스트 ID

```
        Network ID          |   Host ID
11000000 00000000 00000000  |  00000000
   ~        ~        ~      |      ~   
11011111 11111111 11111111  |  11111111

192.0.0.0 ~ 223.255.255.255
```

호스트 수: 254대

| 공인 IP 주소 범위                                            | 사설 IP 주소 범위             |
| ------------------------------------------------------------ | ----------------------------- |
| 192.0.0.0 ~ 192.167.255.255<br />192.169.0.0 ~ 223.255.255.255 | 192.168.0.0 ~ 192.168.255.255 |



## 네트워크 주소와 브로드캐스트 주소의 구조

네트워크 주소와 브로드캐스트 주소는 특별한 주소로 **컴퓨터나 라우터가 자신의 IP로 할당할 수 없다.**

### 네트워크 주소

전체 네트워크에서 작은 네트워크를 식별하는 데 사용, 전체 네트워크의 대표 주소

### 브로드캐스트 주소

네트워크에 있는 컴퓨터나 장비 모두에게 한 번에 데이터를 전송할 때 사용되는 전용 IP 주소

```
C클래스의 사설 IPv4 주소를 예로 들어보자.

네트워크 주소는 호스트 ID가 0(2진수: 00000000)인 주소
192.168.1.0

브로드캐스트 주소는 호스트 ID가 255(2진수: 11111111)인 주소
192.168.1.255
```



## 서브넷의 구조

### 서브넷

대규모 네트워크를 작게 분할한 네트워크를 **서브넷(subnet)**이라고 한다.



### 서브넷 마스크

서브넷을 만들 때 쓰이는 값으로 네트워크 ID와 호스트 ID를 식별한다.

|                 | 이진수 표기                             | 십진수 표기     |
| --------------- | --------------------------------------- | --------------- |
| IP 주소         | 11000000.10101000.00000101.10000010     | 192.168.5.130   |
| 서브넷 마스크   | 11111111.11111111.11111111.**11**000000 | 255.255.255.192 |
| 네트워크 접두사 | 11000000.10101000.00000101.10000000     | 192.168.5.128   |
| 호스트 부분     | 00000000.00000000.00000000.00000010     | 0.0.0.2         |

#### 프리픽스(prefix) 표기법

서브넷 마스크를 `/비트 수`만큼 나타내는 것.

255.255.255.0 ==> /24

C클래스에서 일반적으로 네트워크 ID는 24비트이지만 28비트로 변경하면 4비트를 호스트 ID에서 빌리게 되고 이것이 서브넷 ID가 된다.

|                 | 이진수 표기                             | 십진수 표기     |
| --------------- | --------------------------------------- | --------------- |
| IP 주소         | 11000000.10101000.00000101.10000010     | 192.168.5.130   |
| 서브넷 마스크   | 11111111.11111111.11111111.**11**000000 | 255.255.255.192 |
| 네트워크 접두사 | 11000000.10101000.00000101.10000000     | 192.168.5.128   |
| 호스트 부분     | 00000000.00000000.00000000.00000010     | 0.0.0.2         |

A/24 네트워크에서 서브넷 마스크를 1비트씩 증가시키면 다음과 같은 부분망으로 나눌 수 있다.

| 접두사 크기 | 네트워크 마스크 | 이용 가능한 부분망 | 부분망 당 호스트 수 | 모든 호스트 수 |
| ----------- | --------------- | ------------------ | ------------------- | -------------- |
| /24         | 255.255.255.0   | 1                  | 254                 | 254            |
| /25         | 255.255.255.128 | 2                  | 126                 | 252            |
| /26         | 255.255.255.192 | 4                  | 62                  | 248            |
| /27         | 255.255.255.224 | 8                  | 30                  | 240            |
| /28         | 255.255.255.240 | 16                 | 14                  | 224            |
| /29         | 255.255.255.248 | 32                 | 6                   | 192            |
| /30         | 255.255.255.252 | 64                 | 2                   | 128            |
| /31         | 255.255.255.254 | 128                | 2 (p2p 연결)        | 256            |



## 라우터의 구조

허브나 스위치는 네트워크를 분리할 수 없지만 **라우터는 네트워크를 분할할 수 있다.**

### 기본 게이트웨이

다른 네트워크에 접속하기 위해 현재 송신하려는 컴퓨터가 라우터의 IP 주소를 설정하는데, 이 라우터를 게이트웨이라고 한다. SW 측면을 강조할 때 게이트웨이, HW 측면을 강조할 때 라우터라고 한다.

**라우터**는 다른 네트워크에 있는 호스트 사이를 연결해주는 역할을 수행하며 이를 라우팅(routing)이라고 한다. 라우팅은 경로 정보를 기반으로 현재 네트워크에서 다른 네트워크로 최적 경로를 통해 데이터를 전송하는 방식이다. 경로 정보는 라우팅 테이블에 등록하며, 라우터 간에 라우팅 정보를 서로 교환하기 위한 프로토콜을 라우팅 프로토콜이라고 한다.